day02 이어서

# 스토리지 구성 및 관리

## DAS

### swap
```bash
$ swapon -s
```
#### swap 만들기
```bash
$ lsblk -f
NAME     FSTYPE      LABEL     UUID                                   MOUNTPOINT
sda                                                                   
├─sda1   xfs         red_disk  eb7da13f-0cb3-4733-a3bc-56201934f563   /red
└─sda2                                                                

$ mkswap /dev/sda2
Setting up swapspace version 1, size = 204796 KiB
no label, UUID=68f82a7d-dbdf-4da0-bdac-7b9679714f5d

$ lsblk -f
NAME     FSTYPE      LABEL     UUID                                   MOUNTPOINT
sda                                                                   
├─sda1   xfs         red_disk  eb7da13f-0cb3-4733-a3bc-56201934f563   /red
└─sda2   swap                  68f82a7d-dbdf-4da0-bdac-7b9679714f5d   

$ swapon -s
Filename				Type		Size	Used	Priority
/dev/dm-1                              	partition	3145724	0	-1

$ swapon /dev/sda2 # swap 활성화

$ swapon -s
Filename				Type		Size	Used	Priority
/dev/dm-1                              	partition	3145724	0	-1
/dev/sda2                              	partition	204796	0	-2

$ swapoff /dev/sda2 # 우선 순위 지정을 위해 비활성화

$ vi /etc/fstab # 
	/dev/sda2               swap                    swap    defaults,pri=3  0 0

$ mount -a 
$ swapon -s # mount -a로 swap이 안되는 것을 확인
Filename				Type		Size	Used	Priority
/dev/dm-1                              	partition	3145724	0	-1

$ swapon -a
$ swapon -s
Filename				Type		Size	Used	Priority
/dev/dm-1                              	partition	3145724	0	-1
/dev/sda2                              	partition	204796	0	3

```
- Priority: 양의 정수에 가까울수록 우선 순위가 높음

### LVM

1TB  볼륨 100개를 합쳐 100TB의 볼륨 그룹을 만든다.

- Physical Volumes: 1TB의 물리적인 볼륨
- Volume Groups: 물리 볼륨 여러개를 모아 둔 것
- Logical Volume: 볼륨 그룹을 논리적으로 나눈것
- Extend: 용량,가 관리의 최소 단위, 볼륨 그룹을 만들 때 결정됨(default: 4Mb)

#### LVM 실습
1. vm 강제 종료 `Force Off`(VMM)
2. 이전에 찍어둔 스냅샷으로 롤백 (컴퓨터 2개 합친 아이콘)
3. 디스크 3개 추가 (이전과 동일,  Virtual Machine Manager)
4. LVM 실습, bash

```bash
$ pvs # 물리 볼륨 확인, LVM 전이라 추가한 3개 볼륨이 보이지 않음음
  PV         VG Fmt  Attr PSize  PFree
  /dev/vda2  cl lvm2 a--  29.00g    0

$ pvcreate /dev/sda /dev/sdb
  Physical volume "/dev/sda" successfully created.
  Physical volume "/dev/sdb" successfully created.

$ pvs
 PV         VG Fmt  Attr PSize  PFree
  /dev/sda      lvm2 ---   1.00g 1.00g
  /dev/sdb      lvm2 ---   1.00g 1.00g
  /dev/vda2  cl lvm2 a--  29.00g    0 

$ pvdisplay /dev/sda
  "/dev/sda" is a new physical volume of "1.00 GiB"
  --- NEW Physical volume ---
  PV Name               /dev/sda
  VG Name               
  PV Size               1.00 GiB
  Allocatable           NO
  PE Size               0   
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               fV1zuy-sOLb-0gOA-9B0y-2gzB-kzAQ-MKp9Qb
   
$ vgs # 볼륨 그룹 확인
  VG #PV #LV #SN Attr   VSize  VFree
  cl   1   2   0 wz--n- 29.00g    0

$ vgcreate vgtest /dev/sda /dev/sdb
  Volume group "vgtest" successfully created 

$ vgs
  VG     #PV #LV #SN Attr   VSize  VFree
  cl       1   2   0 wz--n- 29.00g    0 
  vgtest   2   0   0 wz--n-  1.99g 1.99g

$ vgdisplay vgtest
  --- Volume group ---
  VG Name               vgtest
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  1
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               1.99 GiB
  PE Size               4.00 MiB
  Total PE              510
  Alloc PE / Size       0 / 0   
  Free  PE / Size       510 / 1.99 GiB
  VG UUID               K2nsVP-0Zcy-AGjY-topt-AnkH-XvQ0-Ywoz1U

$ vgdisplay vgtest -v # 물리 볼륨, 논리 볼륨 모두 확인
  --- Volume group ---
  VG Name               vgtest
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  1
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               1.99 GiB
  PE Size               4.00 MiB
  Total PE              510
  Alloc PE / Size       0 / 0   
  Free  PE / Size       510 / 1.99 GiB
  VG UUID               K2nsVP-0Zcy-AGjY-topt-AnkH-XvQ0-Ywoz1U
   
  --- Physical volumes ---
  PV Name               /dev/sda     
  PV UUID               fV1zuy-sOLb-0gOA-9B0y-2gzB-kzAQ-MKp9Qb
  PV Status             allocatable
  Total PE / Free PE    255 / 255
   
  PV Name               /dev/sdb     
  PV UUID               hjIrgd-5MLd-f118-4Mxr-Habl-OYn3-V4FS0X
  PV Status             allocatable
  Total PE / Free PE    255 / 255

$ pvdisplay /dev/sda # 볼륨 그룹에 추가된 것을 확인
  --- Physical volume ---
  PV Name               /dev/sda
  VG Name               vgtest
  PV Size               1.00 GiB / not usable 4.00 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              255
  Free PE               255
  Allocated PE          0
  PV UUID               fV1zuy-sOLb-0gOA-9B0y-2gzB-kzAQ-MKp9Qb

$ vgremove vgtest # 볼륨 그룹 삭제
  Volume group "vgtest" successfully removed

$ vgs
  VG #PV #LV #SN Attr   VSize  VFree
  cl   1   2   0 wz--n- 29.00g    0

$ vgcreate -s 16M vgcolor /dev/sda /dev/sdb
  Volume group "vgcolor" successfully created
```
-  vgdisplay
	- `PE Size               4.00 MiB` 기본 값이 4MB인 것을 확인
<!--stackedit_data:
eyJoaXN0b3J5IjpbNTg3MTUzMDkyLC0xNDA2NjUwMDI0LDU0ND
A0ODUzMSwyMDkyMDg4Mzc1LC0yMDg4NzQ2NjEyXX0=
-->