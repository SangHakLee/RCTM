# 컨테이너를 위반 기반 기술

https://hub.docker.com

### Dockerfile
https://github.com/docker-library/httpd/blob/4faace97468d7bced1ac4a072f89f151359ee9fa/2.4/Dockerfile

## chroot
> 특정 디렉토리를 최상위 `/`처럼 보이게 변경

```bash
# host
$ mkdir -p ~/newroot/bin
$ mkdir -p ~/newroot/lib64

$ chroot ~/newroot /bin/bash # 참조 라이브러리가 없어서 오류 발생
chroot: failed to run command ‘/bin/bash’: No such file or directory

$ ldd /bin/bash # 명령어가 참조하는 라이브러리 확인
	linux-vdso.so.1 =>  (0x00007ffc1ffdc000)
	libtinfo.so.5 => /lib64/libtinfo.so.5 (0x00007fa702bd9000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007fa7029d5000)
	libc.so.6 => /lib64/libc.so.6 (0x00007fa702613000)
	/lib64/ld-linux-x86-64.so.2 (0x00007fa702e17000)

# bash 명령에 필요한 라이브러리들 복사
$ cp /lib64/libtinfo.so.5 ~/newroot/lib64
$ cp /lib64/libdl.so.2  ~/newroot/lib64
$ cp /lib64/libc.so.6 ~/newroot/lib64
$ cp /lib64/ld-linux-x86-64.so.2  ~/newroot/lib64
$ cp /bin/bash ~/newroot/bin

$ chroot ~/newroot /bin/bash
bash-4.2# pwd
/
bash-4.2# ls
bash: ls: command not found # ls에 관련된 라이브러리는 복사하지 않았기 때문에 명령어 오류
```

```bash
# host
$ mkdir /tmp/ram
$ cd /tmp/ram

$ /lib/dracut/skipcpio /boot/initramfs-3.10.0-514.26.1.el7.x86_64.img  | zcat | cpio -icdmu # initramfs-3.10.0-514.26.1.el7.x86_64.img = 램디스크
145044 blocks

$ ls /tmp/ram
bin  dev  etc  init  lib  lib64  proc  root  run  sbin  shutdown  sys  sysroot  tmp  usr  var
```
- 복구 모드에서 하드 디스크 대신 램 디스트로 부팅됨
- `sysroot`: 실제 하드 디스크가 마운트되는 위치
	- `chroot sysroot` : 램 디스크 부팅 환경에서 오류 해결을 위해 실제 하드 디스크를 `root`로 보이게 한다


```bash
# 장애 상황
# VM

e 누름
`linux16 ~ UTF-8` rd.break
```
- `
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTQ0ODk5NzE4Nyw4OTkwMDI3OTQsMjQ0MT
gyNzMzLDE2MDYxNDIxMTgsMTU4MjUxNDczOSwtMjA4ODc0NjYx
Ml19
-->