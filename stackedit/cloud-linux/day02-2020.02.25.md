day01 이어서

# 리눅스 파일 다루기
## 명령어

### find
```bash
$ find /etc -name "*.conf"

$ find /var -user lp

$ find /var -group chrony

$ find /home -nouser

$ find /boot -size 5M # 정확하게 5MB 검색
$ find /boot -size +5M # 5MB 이상 검색

$ find /boot -mtime 1 # 1: 24 시간, -1: 24 시간 이내
$ find /boot -mtime +365 # 1년 동안 사용하지 않는 파일들 찾을 때

```
- `-name`: 파일명으로 검색
- `-user`: 소유자로 검색
- `-group`: 그룹으로 검색
- `-nouser`:  계정 정보가 없는 디렉토리 검색. userdel 옵션 없이 사용 시 정보는 /home 에 남기 때문에
- `-size`: `+ / -`  없이 사용하면 정확하게 수치에 맞는 값으로 검색
- `-mtime`: 
	- `-atime`: 접근 시간
	- `-ctime`: 파일 수정 시간
	-  `-mtime`: 파일 내용 수정 시간
	- https://www.unixtutorial.org/atime-ctime-mtime-in-unix-filesystems


#### 퍼미션 실습
```bash
$ for num in 1 2 3 4 5 6 7; do
> touch $num.txt
> chmod ${num}00 $num.txt
> done

$ find . -perm 300 # 300 정확히 검색

$ find . -perm -300 # 300 퍼미션을 갖고만 있다면 검색, wx를 갖기만 하면
우
$ find . -perm +300
find: warning: you are using `-perm +MODE'.  The interpretation of `-perm +omode' ch면anged in findutils-4.5.11.  The syntax `-perm +omode' was removed in findutils-4.5.12, in favour of `-perm /omode'.
./3.txt
$ find . -perm /300 # +는 deprecated, wx 중 하나라도 갖고 있는 경우경
```

### 리다이렉션
```bash
$ tr a-z A-Z < /etc/fstab # /etc/fstab 내용의 소문자를 대문자로 변경
```

### 파이프
```bash
$ cat /etc/passwd | grep bash | cut -d: -f1,3,6- | sort
```

#### grep
```bash
$ grep nologin /etc/passwd

$ grep ano /etc/passwd
$ grep ano /etc/passwd -i

$ grep nologin /etc/passwd -v

$ grep /etc/passwd -e asa -e ssh -e root
```
- `-i`: 대소문자 구분 X
- `-v`: not
- `-e`: 여러개 검색

## 환경 변수
- 변수
	- 로컬 변수
	- 환경 변수

변수 사용
> $ echo ${변수명}
> 
> $ env {명령어}
>
> $ set {명령어}

로컬 변수 설정, 수정
> $ 변수명=값

환경 변수 설정, 수정
> $ export 변수명=값값

https://zetawiki.com/wiki/리눅스_환경변수,_지역변수

```bash
$ age=10
$ color=red
```

### $PATH
상대 경로로 실행되는 명령어의 경로를 관리

```bash
$ echo $PATH
리
$ skipcpio
bash: skipcpio: command not found...

$ /usr/lib/dracut/skipcpio
Usage: /usr/lib/dracut/skipcpio <file>

$ PATH=$PATH:/usr/lib/dracut

$ skipcpio
Usage: /usr/lib/dracut/skipcpio <file>
```

### Nesting 명령어
```bash
$ echo today is `date`

$ echo today is $(date)
```

## bash 설정
```bash
# ~/.bash_profile
PATH=$PATH:$HOME/bin:/usr/lib/dracut
age=20
color=red

export PATH age

/usr/bin/cal
```

```bash
# ~/.bashrc
set -o ignoreeof

umask 077
```

```bash 
$ source ~/.bash_profile
$ . ~/.bashrc
```
- 설정 적용


# 리눅스 프로세스 관리하기

## 프로세스

### ps
```bash
$ ps
  PID TTY          TIME CMD
 4486 pts/0    00:00:00 bash
 6799 pts/0    00:00:00 ps

$ ps -f
UID        PID  PPID  C STIME TTY          TIME CMD
root      4486  4456  0 09:30 pts/0    00:00:00 bash
root      6779  4486  0 11:43 pts/0    00:00:00 ps -f

$ ps --forest
  PID TTY          TIME CMD
 4486 pts/0    00:00:00 bash
 6791 pts/0    00:00:00  \_ ps

$ ps -ef # e: 시스템 전체의 프로세스 확인 

$ pstree # 트리 구조 출력
```

### top
```bash
$ top
```
- shift + m :  메모리 우선 순위
- shift + p :  CPU 우선 순위

## 프로세스 Lifecycle

fork: 현재 프로세스가  자식 프로세스 생성
exec: 현재 프로세스를 덮어 씌워 프로세스 생성

### echo $?
오류 발생 시 0 이외의 양의 정수 
```bash
$ cal # no error
$ echo $? # 0

$ data # error
$ echo $? # 127

$ ls /et # error
$ echo $? # 2
```

## 시그널

단축키: 포그라운드 프로세스
명령어: 백그라운드 프로세스

### kill
```bash
$ kill -l
 1) SIGHUP	 2) SIGINT	 3) SIGQUIT	 4) SIGILL	 5) SIGTRAP
 6) SIGABRT	 7) SIGBUS	 8) SIGFPE	 9) SIGKILL	10) SIGUSR1
11) SIGSEGV	12) SIGUSR2	13) SIGPIPE	14) SIGALRM	15) SIGTERM
16) SIGSTKFLT	17) SIGCHLD	18) SIGCONT	19) SIGSTOP	20) SIGTSTP
21) SIGTTIN	22) SIGTTOU	23) SIGURG	24) SIGXCPU	25) SIGXFSZ
26) SIGVTALRM	27) SIGPROF	28) SIGWINCH	29) SIGIO	30) SIGPWR
31) SIGSYS	34) SIGRTMIN	35) SIGRTMIN+1	36) SIGRTMIN+2	37) SIGRTMIN+3
38) SIGRTMIN+4	39) SIGRTMIN+5	40) SIGRTMIN+6	41) SIGRTMIN+7	42) SIGRTMIN+8
43) SIGRTMIN+9	44) SIGRTMIN+10	45) SIGRTMIN+11	46) SIGRTMIN+12	47) SIGRTMIN+13
48) SIGRTMIN+14	49) SIGRTMIN+15	50) SIGRTMAX-14	51) SIGRTMAX-13	52) SIGRTMAX-12
53) SIGRTMAX-11	54) SIGRTMAX-10	55) SIGRTMAX-9	56) SIGRTMAX-8	57) SIGRTMAX-7
58) SIGRTMAX-6	59) SIGRTMAX-5	60) SIGRTMAX-4	61) SIGRTMAX-3	62) SIGRTMAX-2
63) SIGRTMAX-1	64) SIGRTMAX

$ kill # 시그널 없으묜 15번 SIGTERM 디폴트
```
- `ctrl + c`: SIGINT 2번
- `ctrl + d`: SIGTERM 15번
- `ctrl + z`: SIGTSTP 20번


```bash
$ sleep 3000 &
$ ps
  PID TTY          TIME CMD
 4486 pts/0    00:00:00 bash
 7448 pts/0    00:00:00 sleep
 7460 pts/0    00:00:00 ps

$ fg
sleep 3000
^Z
[2]+  Stopped                 sleep 3000

$ bg %1
$ jobs # running

$ kill -20 7448
[2]+  Stopped                 sleep 3000

$ kill -18 7448

$ kill 7448
[2]+  Terminated              sleep 3000

$ ps
  PID TTY          TIME CMD
 4486 pts/0    00:00:00 bash
 7565 pts/0    00:00:00 ps
```

#### killall
> 프로세스 이름으로 접근
```bash
$ sleep 200

$ ps

$ killall sleep
```

#### pkill
```bash
$ sleep 100

$ ps

$ pkill sleep
```

### nohup

``` bash
# user
$ nohup sleep 2020 & # pid: 7746  ppid: 5501
```

## 우선 순위
### nice
19 ~ -20: 속도 낮음 ~ 속도 높음

0: default
19 ~ 0: 일반 사용자

#### renice
```bash
$ renice -n -4 {PID}
```
프로세스의 priory 값을 재조정, -4 한다.

## 스케줄링
### at
```bash
$ at -t 202002251439
at> /usr/bin/df > /tmp/at.result # Ctrl + d

$ atq
2	Tue Feb 25 14:39:00 2020 a root
```

### crontab
```bash
$ crontab -e # 설정

$ crontab -r # 삭제
```

### anacron
```
$ cat /etc/anacrontab
```

# 리눅스 파일 편집하기

## vi
```
$ vi ~/.vimrc
: set all
```
- `set all`: 설정 리스트

`vimrc`에  설정 값을 넣어주면 vi의 기본 설정을 셋팅할 수 있다.

# 스토리지 구성 및 관리

Storage
- [DAS](https://ko.wikipedia.org/wiki/직접_연결_저장장치)
- [NAS](https://ko.wikipedia.org/wiki/네트워크_결합_스토리지)
	- cifs
	- nfs
- [SAN](https://ko.wikipedia.org/wiki/스토리지_에어리어_네트워크)
	- FC-SAN
	- IP-SAN
		- [iSCSI](https://ko.wikipedia.org/wiki/ISCSI) 
		- FCoE

> 네트워크를 통해 전송되는 단위가
> file이면 NAS
> disk면 SAN

요즘엔 파티셔닝 안함. LVM

## DAS

- `IDE`: /dev/hd`{알파벳}{숫자}`
- `SATA, SAS, SCSI`: /dev/sd`{알파벳}{숫자}`
- `virtual`: /dev/vd`{알파벳}{숫자}`

알파벳: VM이 디스크를 인식한 순서
숫자: 파티션 번호
> 숫자가 없다면 아직 파티셔닝이 안된 것


#### fdisk
고전 파티셔닝 시스템, 2TB 까지 지원 가능

#### parted
`fdisk`의 단점을 보완한 시스템
하지만, 즉시 적용이라는 특성 때문에 실수가 많이 생김

#### gdisk
2TB 이상 가능, 인터페이스가 `fdisk` 와 동일


### 실습
1. Virtual Machine Manager
	- SCSI 스토리지 3개 추가
1. $ lsblk
	- 1G 디스크 3개 확인
	```bash
	$ lsblk
	NAME        MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
	sda           8:0    0   1G  0 disk 
	sdb           8:16   0   1G  0 disk 
	sdc           8:32   0   1G  0 disk 
	vda         252:0    0  30G  0 disk 
	├─vda1      252:1    0   1G  0 part /boot
	└─vda2      252:2    0  29G  0 part 
	  ├─cl-root 253:0    0  26G  0 lvm  /
	  └─cl-swap 253:1    0   3G  0 lvm  [SWAP]\
	```것
1. fdisk 실습

#### fdisk 실습
2단계 이후 작업
```bash
$ fdisk /dev/sda
  p # 현재 파티션 확인
       Device Boot      Start         End      Blocks   Id  System
  n # 파티션 생성
    p # primary
    1 # number
      # enter, default
    +300M # 300MB 할당
  p
       Device Boot      Start         End      Blocks   Id  System
/dev/sda1            2048      587775      292864   83  Linux
```

 ##### 파티션 종류
 - primary
	 - 개수의 제약이 존재, 최대 4개
		 - MBR(512B)
 - extend
	 - logical을 묶는 용도
	 - 실제 파티션이 아님
 - logical





<!--stackedit_data:
eyJoaXN0b3J5IjpbMTY5ODMyNzAyMywxOTMwMTgxNjAxLDIwMz
QzNzAwMTYsLTE1NzIxMTI5NTUsMTEyOTA2NTU0MiwtNDMwMjUw
OTU4LDQxOTM1OTUxNiwtMTkyMzE4NzMyNiwyMDExNDM0NTczLD
EyOTgzMTE4MDIsNDY0MTE0MDAxLDU2ODE2Mjc3OSwtMTc2NzE1
MzUyOSwtMjEyMDYyNzQ0MywtMTMwMTI3OTM3MCwtMjA1Njk4MD
AzMCwxMjM5OTQ2MjU5LDM3ODEwNTI0MywtMTY4NzAxMTA3NSwt
MzE1OTkyNjAwXX0=
-->