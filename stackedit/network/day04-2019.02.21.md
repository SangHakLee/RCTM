# Day04

## Day03 복습
### Subnet mask
#### Class A
5.1.1.0/8
	- 호스트 2^24 - 2 

### Router
- Routing & Switching
- Packet filtering
	- Firewall
- VPN
- NAT
	- Reverse proxy
- DHCP: IP Address 자동 할당
- Load Balancer: 부하 분산

### Windows Firewall 설정
- `firewall.cpl`
	- Inbound 설정만 가능, 단순한 기능
- `wf.msc`
	- Inbound, Outbound 모두 설정, 다양한 기능

### 용어 정리
- Host
	- 주인
- Guest

---

- Physical
- Virtual

---

- Proxy
- Redirection
- Forward

## 실습
### vm1, vm2 통신
Day03의 NAT, 포트 포워딩의 문제점을 해결한 방법을 실습

현재 포트 포워딩으로 445(SMB) 포트를 연결하여 폴더 공유는 가능하나 다른 포트에 대한 vm1 -> vm2는 불가능

1. Static Route 추가
	- Router1, Router2 모두 라우팅 경로가 필요하다
		- 통신의 기본은 **주고 받는** 것이기 때문에
2. NAT 제거
	- NAT는 사설 주소를 공인 주소로 변환해서 보내기 때문에 이것이 설정되어 있으면 제대로 통신이 안된다.

#### 현재 구성도
![p307](https://user-images.githubusercontent.com/9030565/53076336-cae2aa00-3532-11e9-963d-c913d175a9e4.png)

#### 이더넷 이름 변경
![이더넷 이름 변경](https://user-images.githubusercontent.com/9030565/53138426-97069380-35c9-11e9-89f3-a744e3c13249.png)
- Router1, Router2
	- Ethernet -> Public
	- Etherner2 -> Private
- vm1, vm2
	- Etherner -> Private

####  Static Route
![Router1의 Static Route](https://user-images.githubusercontent.com/9030565/53139100-e352d300-35cb-11e9-9161-c5f02d485b2a.png)
- Router1의 Static Route
	- Destination: `10.10.2.0`
		- Router2의 네트워크 대역을 적는다.
		- `10.10.2.2` host 주소를 적으면 해당 호스트만 통신 가능하기 때문에 network 주소를 적는다.
	- Network mask: `255.255.255.0`
	- Gateway: `192.168.1.83`
		- Router2의 공인망 게이트웨이 주소를 적는다

![Router2의 Static Route](https://user-images.githubusercontent.com/9030565/53139166-201eca00-35cc-11e9-97f6-d452a1a2e82b.png)
- Router2의 Static Route
	- Destination: `10.10.1.0`
	- Network mask: `255.255.255.0`
	- Gateway: `192.168.1.77`

####  NAT 제거
NAT 설정이 있으면 안된다.
![NAT 제거](https://user-images.githubusercontent.com/9030565/53139239-5eb48480-35cc-11e9-93e5-c337f5a643ad.png)

> 하지만, NAT 설정을 지우면 공인망 8.8.8.8과 통신이 안된다.(vm1 -> 8.8.8.8)
> 
> 현재 NAT가 지워진 경우 (vm1-> Router1 -> webtime -> internet)
> 1. vm1 -> Router1
>   - 출발지 `10.10.1.2`
>   - 목적지 `8.8.8.8`
> 2. Router1 -> webtime
>   - 출발지 `10.10.1.2`(NAT가 있었다면, 192.168.1.77로 변환)
>   - 목적지 `8.8.8.8`
> 3. webtime -> internet
>   - 출발지 `122.220.31.218`(webtime의 NAT가 자동으로 변환, 사설 IP는 그대로 나갈 수 없기 때문에 default)
>   - 목적지 `8.8.8.8`
>
> **vm1 -> 8.8.8.8 까지는 도달할 수 있으나, 통신은 `송수신`이기 때문에 응답이 vm1까지 다시와야 한다.**
>
> 4. internet -> webtime
>   - 출발지 `8.8.8.8`
>   - 목적지 `122.220.31.218`(webtime -> internet에서 나갈 때 NAT 정보가 없어 default로 나갔기 때문에 다시 들어갈 주소를 모른다)
> 
> **webtime까지는 왔으나 더 이상 갈 곳이 없기 때문에 패킷을 버린다.**


### 자동 Route
#### Static Route 제거
Router1, Router2 
위 과정에서 생성한 Static Route 모두 제거

Router1, Router2
1. Routing and Remote Access
3. IPv4 - General - New Routing Protocol 클릭
	- RIP 선택
4. RIP - New Interface
	- Public 선택
	- **Activate authentication** 선택
		- password: 1111

#### New Routing Protocol  - RIP
![New Routing Protocol](https://user-images.githubusercontent.com/9030565/53140806-3c713580-35d1-11e9-8cbf-6e487ff7e6ba.png)

#### New Interface - Public
![RIP Public으로 수정 1](https://user-images.githubusercontent.com/9030565/53140812-42ffad00-35d1-11e9-8cef-e507af37b391.png)
- NAT가 삭제된 상태

![RIP Public으로 수정 2](https://user-images.githubusercontent.com/9030565/53141208-a0e0c480-35d2-11e9-8978-536b6de53e84.png)
- **Activate authentication** 선택
	- 현재 실습 환경에선 같은 10.10.1.x를 사설 네트워크로 다 같이 사용하고 있고 Router1의 External 네트워크는 192.168.1.x를 공유하기 때문에 5명 수강생이 모두 같은 네트워크에 있는 것처럼 통신되기 때문에 불가
		- 10.10.1.x, 10.10.11.x, 10.10.12.x 으로 각 수강생의 사설 네트워크를 변경하든지
		- Activate authentication을 선택해서 같은 비밀번호는 사용하는 네트워크끼리만 통신하게 변경한다.
		- 이 때 수강생마다 비밀번호는 모두 다르게 설정한다.


### 1
#### centos1 복사
1. 정지 centos1 복사 후 centos2 centos 3
2. 가상 컴퓨터 생성
	3. C\VMs에 복사된 파일 사용
3. hostname 수정


![centos 파일 복사](https://user-images.githubusercontent.com/9030565/53141528-d1752e00-35d3-11e9-938e-364d59f573f0.png)

- centos1 192.168.1.95
- centos2 192.168.1.29
- centos3 192.168.1.31

https://mobaxterm.mobatek.net
