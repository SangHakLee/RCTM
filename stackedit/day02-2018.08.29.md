
## Nova Database
p59

```bash
$ cd /etc/nova
$ vi nova.conf

$ grep -E -v '^$|^#' nova.conf | less # 주석 제거해서 보여줌
```

```bash
# /etc/nova/nova.conf
# ...
[DEFAULT]

reserved_host_memory_mb=512
cpu_allocation_ratio=16.0
ram_allocation_ratio=1.5

transport_url=rabbit://guest:guest@192.168.122.100:5672/

osapi_volume_listen=0.0.0.0

[api]
auth_strategy=keystone
use_forwarded_for=False
fping_path=/usr/sbin/fping
[api_database]
connection=mysql+pymysql://nova_api:a30082baa7bb47e3@192.168.122.100/nova_api

[database]
connection=mysql+pymysql://nova:a30082baa7bb47e3@192.168.122.100/nova

[libvirt]
virt_type=qemu
inject_password=False
inject_key=False
inject_partition=-1
live_migration_uri=qemu+ssh://nova_migration@%s/system?keyfile=/etc/nova/migration/identity
cpu_mode=none
vif_driver=nova.virt.libvirt.vif.LibvirtGenericVIFDriver

[oslo_policy]
policy_file=/etc/nova/policy.json
호
[spice]

```
- `reserved_host_memory_mb`: host 기본 메모리 크기
- `cpu_allocation_ratio`: 물리 cpu 곱하기해서 vCore
	- 만약, 물리 cpu가 4 core 면 64 vCore 까지 가능
- `ram_allocation_ratio`: 물리 memory 곱하기해서 vMemory
- `transport_url`: 메시지 브로커
- `osapi_volume_listen`: oslo API
- `[api]`: 기본적으로 keystone 사용
- `[api_database]`: 인증관련 DB, 임시적 데이터
- `[api_database]`: 데이터 DB, 고정적인 데이터
- `[libvirt]`: 마이그레이션 시 문제가 많이 생기는 부분
	- 마이그레이션 설명 p59
	- https://www.mirantis.com/
- `[spice]`: redhat 계열에선  spice 선호


## 인스턴스

#### 인스턴스 생성
캡처

### vnc 오류 안 뜰 때 
```bash처
$ yum install tigervnc -y 
$ yum install xorg-x11-xauth -y

$ logout

$ ssh -XY root@192.168.90.100
```
- `tigervnc`: vnc 클라이언트
- `xorg-x11-xauth`: x-window 포워딩 인증 패키지

#### 그래도 dashboard에서 vnc 안됨. 임시로 vnc만 가능한지 확인함. 아래 명령어
```bash
$ vncviewer localhost:5900
```

#### 해결법 

아래 두가지 내용을 수정, 수정할 때 기존 내용은 주석처리
```bash
# /etc/nova/nova.conf
vncserver_listen=0.0.0.0
vncserver_proxyclient_address=0.0.0.0
```
nova 재시작
```bash
~(keystone_admin)] $ openstack-service start nova 
```

http://talk.howtodothat.kr


```bash
~(keystone_admin)]$ virsh domiflist 1
```
### Nova

#### /var/lib/nova/instances/_base



<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE3NzE1ODE0ODEsMjUxNjE4MjE1LC0xOD
Y4MjI4Mzc5LDE0NzA5ODAzMDAsNTUyNzA2MzEzLC0xNjAzNDAy
NDMsLTM4NTE3NjYyNSw0OTc4MTg4MTAsLTIwODg3NDY2MTIsNz
MwOTk4MTE2XX0=
-->